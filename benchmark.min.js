(function(){"use strict";const styles=`body{background:#222;color:#aaa}.benchmarks{padding:0;margin:0}.benchmarks .before-script{margin-top:0!important;padding-top:10px!important}.benchmarks .before-script:empty{display:none}.benchmarking .benchmarks .before-script,.benchmarking .benchmarks pre,.benchmarking .benchmarks .eval,.benchmarking .benchmarks h2{display:none}.benchmarks *{font-family:monospace}.benchmarks *{scrollbar-width:auto;scrollbar-color:#737373 #000000}.benchmarks *::-webkit-scrollbar{width:10px;height:10px}.benchmarks *::-webkit-scrollbar-track{background:#000000}.benchmarks *::-webkit-scrollbar-track:hover{background-color:#111}.benchmarks *::-webkit-scrollbar-thumb{background-color:#555;border-radius:10px;border:1px none #292929}.benchmarks *::-webkit-scrollbar-thumb:hover{background-color:#737373}.benchmarks .test-list>*{position:relative}.benchmarks .test-list>*>h2{font-size:14px;position:absolute;color:#fff;top:-21px;left:10px;background-color:#111;border-radius:10px;padding:0 10px}.benchmarks .code{margin-top:30px;display:block;padding:20px 10px 10px;overflow-x:auto;background-color:#111}.hide-code .benchmarks .code{display:none}.benchmarks .license{padding:10px;font-size:11px;color:#777;font-family:tahoma,Arial,Helvetica,sans-serif}.benchmarks .license a:hover{color:#aaa}.benchmarks .license *{font-family:inherit;color:inherit}.benchmarks .row{margin:15px 0}.benchmarks label{margin:0 10px}.benchmarks input{background:black;border:none;outline:none;padding:5px;color:#aaa;margin-left:5px;max-width:100px}.benchmarks button{background:#444;color:#eee;border:1px solid #555;outline:none;padding:5px 10px;cursor:pointer}.benchmarks button:hover{background:#555}.benchmarks button[disabled]{opacity:.5;pointer-events:none}.benchmarking .benchmarks .toggle-code{display:none}.benchmarks .toggle-code:after{content:"Hide code"}.hide-code .benchmarks .toggle-code:after{content:"Show code"}.benchmarks .back-to-code{display:none}.benchmarking .benchmarks .back-to-code{display:inline-block}.benchmarks .eval{max-height:min(100%,300px);overflow-y:auto;background:#111;padding:10px;margin-bottom:10px;white-space:nowrap}.hide-code .benchmarks .eval{margin-top:30px;padding-top:20px}.benchmarks .eval.pre{white-space:pre}.benchmarks .eval.error{background-color:#200;color:#f87}.benchmarks .eval:empty{display:none}.benchmarks .ms:after{content:"ms";margin-left:3px}.benchmarks .log{padding-left:10px}.benchmarks .log b{color:#0f0;font-weight:400}
`;HTMLElement.prototype.insert=function(n,t,...e){if(typeof e[0]=="object"){const a=e.shift();t=new Function(Object.keys(a).join(","),"return `"+t+"`")(...Object.values(a))}const o=document.createElement("div");o.innerHTML=t;const r=o.children[0];return this.insertAdjacentElement(n,o.children[0]),[r,...e.map(a=>r.querySelector(a))]},HTMLElement.prototype.append=function(){return this.insert("beforeend",...arguments)},HTMLElement.prototype.prepend=function(){return this.insert("afterbegin",...arguments)},Promise.timeout=function(n){return new Promise(t=>setTimeout(t,n))},Array.prototype.trim=function(n=t=>!t){const t=(r,a)=>!n(r,a,this),e=this.findIndex(t);if(e===this.length-1)return[];const o=this.findLastIndex(t);return this.splice(o+1),this.splice(0,e),this};const containerTpl=`<div class="benchmarks">
    <div class="row toolbar">
        <button class="run-benchmark">Benchmark</button>
        <label>Cycles:<input class="cycles" type="number"></label>
        <button class="back-to-code">Back to code</button>
        <button class="toggle-code"></button>
    </div>
    <pre class='code before-script'>\${formatCode(beforeScript)}</pre>
    <div class="test-list">

    </div>
    <div class="license">
        <a target="_blank" href="https://github.com/silentmantra/benchmark">
            <!--<img src="https://github.githubassets.com/favicons/favicon-dark.png">-->
            Benchmark</a> by <a
            href="mailto:aleks4hour@gmail.com">Alexander Nenashev</a>
        \${new Date().getFullYear()}&copy;
    </div>
</div>`,benchmarkTpl=`<div>
    <h2>\${title}</h2>
    <pre class="code">\${formatCode(source)}</pre>
    <div class="eval"></div>
    <div class="log"></div>
</div>`;document.head.append(`<style>${styles}</style>`),document.body.classList.add("hide-code"),document.querySelectorAll("script[name=benchmark],script[benchmark]").forEach(init);async function init(scriptContainer){const script=scriptContainer.textContent;let scripts=script.split("@benchmark");const beforeScript=scripts.shift().split(`
`).slice(0,-1).join(`
`);scripts=scripts.map((n,t,e)=>{const o=n.split(`
`),r=o.shift().trim();return t!==e.length-1&&o.pop(),{title:r,source:o.join(`
`)}});const[$container,$benchmarks]=document.body.append(eval("`"+containerTpl+"`"),".test-list"),tests=[];for(const n of scripts){const[t,e]=$benchmarks.append(benchmarkTpl,{formatCode,...n},".eval");(async()=>{let o;try{const[r]=await evalScript(n.source);o=JSON.stringify(r,null,4)}catch(r){o=r.message,e.classList.add("error")}e.innerHTML=o})(),tests.push({...n,benchmark:t})}const max=Math.max(...tests.map(n=>n.title.length));tests.forEach(n=>n.title=n.title.padEnd(max," ")),$container.querySelector(".cycles").value=scriptContainer.dataset.count||1e5,$container.querySelector(".back-to-code").addEventListener("click",n=>{document.body.classList.remove("benchmarking")}),$container.querySelector(".toggle-code").addEventListener("click",n=>{document.body.classList.toggle("hide-code")}),$container.querySelector(".run-benchmark").addEventListener("click",async n=>{document.body.classList.add("benchmarking"),n.target.disabled=!0;const t=$container.querySelector("input.cycles").valueAsNumber;await Promise.all(tests.map(async e=>{let[o,r]=e.source.split(/\/\/\s*@run/);r||([r,o]=[o,r]);const[a,c]=await evalScript(`
                ${o||""}
                for (let i = 0; i < ${t}; i++) {
                    ${r}
                }
            `);(e.executions??(e.executions=[])).push(c);const s=e.executions.reduce((i,d)=>i+d);e.average=Math.round(s/e.executions.length);const l=[];e.executions.length>1&&l.push('<b style="color: orange">'+e.average+'</b><span class="ms"></span>/avg'),e.benchmark.querySelector(".log").innerHTML=[e.title.replace(/\s/g,"&nbsp;")+"&nbsp:",...l,...e.executions.map(i=>"<b>"+i+'</b><span class="ms"></span>')].join("&nbsp;&nbsp;")})),tests.sort((e,o)=>e.average-o.average).forEach(e=>$benchmarks.appendChild(e.benchmark)),n.target.disabled=!1})}async function evalScript(n){const t=document.createElement("script"),e=Math.random().toString().slice(2).split("").reverse().join("");return t.src=`data:text/javascript,
        try {
            const __$start$ = performance.now();
            window.__result${e} = eval(\`${n}\`);
            window.__duration${e} = performance.now() - __$start$;
        } catch (e) {
            window.__error${e} = e;
        }
    `,document.body.appendChild(t),new Promise((o,r)=>{t.onload=()=>{if(window["__error"+e]){const s=window["__error"+e];delete window["__error"+e],r(s)}const a=window["__result"+e],c=window["__duration"+e];delete window["__result"+e],delete window["__duration"+e],t.remove(),o([a,c])},t.onerror=r})}function formatCode(n){const t=n.split(`
`),e=t.reduce((r,a)=>{const c=a.trim()?a.search(/\S/):1e5;return r===null||c<r?c:r},null),o=t.trim().map(r=>r.slice(e)).join(`
`);try{return hljs.highlight(o,{language:"js"}).value}catch{return o}}})();
